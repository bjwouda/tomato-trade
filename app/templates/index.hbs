<div class="container">
  <div class="row text-right">
    <a href="#" class="{{if (eq i18n.locale 'en') 'lead'}}" {{action "changeLang" 'en'}}>EN</a>
    <a href="#" class="{{if (eq i18n.locale 'nl') 'lead'}}" class="lead" {{action "changeLang" 'nl'}}>NL</a>
    <a href="#" class="{{if (eq i18n.locale 'zh') 'lead'}}" {{action "changeLang" 'zh'}}>ZH</a>
  </div>
</div>

<div class="title-container">
    <span class="line-1">{{t 'masterScreen'}}</span>
</div>

<div class="container">
  <div class="starter-template">
    <div class="row">
      <button type="button" class="btn btn-default" {{action 'createNewGame'}}>New game</button>
    </div>
    
    <hr>
  
    {{#each model as |game|}}

        {{#unless game.isDeleted}}
          <div class="row">
            <button class="btn btn-danger" {{action 'removeGame' game}}>Delete game</button>
            <button class="btn btn-default" {{action 'addUser' game 'seller'}}>Add seller</button>
            <button class="btn btn-default" {{action 'addUser' game 'buyer'}}>Add buyer</button>
          </div>
          
          <div class="row">
             
           
           
            {{#each game.sellers as |seller|}}
              <div class="col-sm-3">
                <h3>Seller {{seller.playerPosition}}</h3>
                <div class="form-group">
                  <label>Name: </label> {{input value=seller.name class="form-control" }}
                </div>
                <div class="form-group">
                  <label>{{capitalize (t 'goalTomatoes')}}: </label> {{input value=seller.goalTomatoes class="form-control" }}
                </div>
                <div class="form-group">
                  <label>{{capitalize (t 'currentTomatoes')}}: </label> {{input value=seller.tomatoes class="form-control" }}
                </div>
                
                <hr>
                
                <div class="form-group">
                  <label>{{capitalize (t 'tomatoes')}}: </label> {{input value=seller._offerTomato class="form-control" }}
                </div>
                <div class="form-group">
                  <label>{{capitalize (t 'price')}}: </label> {{input value=seller._offerPrice class="form-control" }}
                </div>
                
                {{!--Tomatoes: {{input value=seller.tomatoes}}--}}
                {{!--Money: {{input value=seller.money}}--}}
                {{#if seller.hasDirtyAttributes}}
                  <button class="btn btn-primary btn-xs" {{action 'saveUser' seller}}>save</button>
                  <button class="btn btn-primary btn-xs" {{action 'rollbackUser' seller}}>cancel</button>
                {{/if}}
                <button class="btn btn-primary btn-xs" {{action 'sendOffer' game 0 seller seller._offerTomato seller._offerPrice}}>send offer</button>
                <button class="btn btn-danger btn-xs" {{action 'deleteUser' seller}}>delete</button>
                {{#link-to 'player' seller}}Activate{{/link-to}}
                
                <h5>Received offers</h5>
                <ul class="list-group">
                  {{#each seller.externalStuff.openOffers as |offer|}}
                    <li class="list-group-item">
                      --&gt; <b>{{offer.receiverName}}</b> <i>{{moment-format offer.ts "HH:mm:ss"}} / {{moment-from-now offer.ts hideSuffix=true interval=1000}}</i> <br>
        
                      {{offer.tomatoes}} <span class="to-tomato"></span> for {{offer.price}} <span class="to-money"></span> 
                      
                      <button class="btn btn-default" {{action 'recallOffer' offer}}>{{t 'recall'}}</button>
                    </li>
                  {{/each}}

                  {{#each seller.externalStuff.sentOffers as |offer|}}
                    <li class="list-group-item">  
                      &lt;-- <b>{{offer.senderName}}</b> <i>{{moment-format offer.ts "HH:mm:ss"}} / {{moment-from-now offer.ts hideSuffix=true interval=1000}}</i> <br>
                
                      {{offer.tomatoes}} <span class="to-tomato"></span> for {{offer.price}} <span class="to-money"></span> 
                      
                      <button  class="btn btn-success" {{action 'acceptOffer' offer}}>{{t 'accept'}}</button>
                      <button  class="btn btn-default" {{action 'declineOffer' offer}}>{{t 'decline'}}</button>
                    </li>
                  {{/each}}
                </ul>
              </div>
            {{/each}}
        
            
            {{#each game.buyers as |buyer|}}
              <div class="col-sm-3">
                <h3>Buyer {{buyer.playerPosition}}</h3>
                <div class="form-group">
                  <label>Name: </label> {{input value=buyer.name class="form-control" }}
                </div>
                <div class="form-group">
                  <label>{{capitalize (t 'goalTomatoes')}}: </label> {{input value=buyer.goalTomatoes class="form-control" }}
                </div>
                <div class="form-group">
                  <label>{{capitalize (t 'currentTomatoes')}}: </label> {{input value=buyer.tomatoes class="form-control" }}
                </div> 
                
                <hr>
                
                <div class="form-group">
                  <label>{{capitalize (t 'tomatoes')}}: </label> {{input value=buyer._offerTomato class="form-control" }}
                </div>
                <div class="form-group">
                  <label>{{capitalize (t 'price')}}: </label> {{input value=buyer._offerPrice class="form-control" }}
                </div>
                
                {{!--Tomatoes: {{input value=buyer.tomatoes}}--}}
                {{!--Money: {{input value=buyer.money}}--}}
                {{#if buyer.hasDirtyAttributes}}
                  <button class="btn btn-primary btn-xs" {{action 'saveUser' buyer}}>save</button>
                  <button class="btn btn-primary btn-xs" {{action 'rollbackUser' buyer}}>cancel</button>
                {{/if}}
                <button class="btn btn-primary btn-xs" {{action 'sendOffer' game 0 buyer  buyer._offerTomato buyer._offerPrice}}>send offer</button>
                <button class="btn btn-danger btn-xs" {{action 'deleteUser' buyer}}>delete</button>
                {{#link-to 'player' buyer}}Activate{{/link-to}}
      
                <h5>Received offers</h5>
                {{#each buyer.receivedOpenOffers as |offer|}}
                  <p><b>{{offer.senderName}}</b> T: {{offer.tomatoes}} M: {{offer.price}} 
                  <button {{action 'recallOffer' offer}}>recall</button> </p>
                {{/each}}
              </div>
            {{/each}}
          </div>
  
          <h3>Offers</h3>
          {{#each game.sortedOffers as |offer|}}
            <p> [{{offer.state}}] <b>{{offer.senderName}}</b> --&gt; <b>{{offer.receiver.name}}</b>  {{moment-format offer.ts "HH:mm:ss"}} / {{moment-from-now offer.ts hideSuffix=true interval=1000}} T: {{offer.tomatoes}} M: {{offer.price}}</p>
          {{/each}}
  
          <hr>

        {{/unless}}
    {{/each}}

  </div>
</div>
<!-- /.container -->
{{outlet}}