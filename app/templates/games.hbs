<div class="container-fluid">
  <div class="row row-offcanvas row-offcanvas-left">
    <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
      <div class="sidebar-nav">
        <ul class="nav">
          {{#unless game.isDeleted}}
            <li> <span class="title-container"><h4>Round Controlls</h4></span></li>

            {{#if (and game.gameIsAboutToStart game.gameConfigurationValid)}}
              <li class="active" {{action 'nextRound' game game.minutesPerRound}}><a href="">Start Game</a></li>
              <li class="nav-divider"></li>
            {{/if}}


            {{#if game.gameIsRunning}}
              {{#if game.isLastRound}}
                <li class="active" {{action 'nextRound' game game.minutesPerRound}}><a href="">End Game</a></li>
                <li class="nav-divider"></li>
              {{else}}
                <li class="active" {{action 'nextRound' game game.minutesPerRound}}><a href="">Next Round</a></li>
                <li class="nav-divider"></li>
              {{/if}}
            {{/if}}

            {{#if game.gameIsRunning}}            

              {{#if game.isPaused}}
                <li class="active" {{action 'resumeGame' game}}><a href="">Resume game</a></li>
              {{else}}
                <li class="active" {{action 'pauseGame' game}}><a href="">Pause</a></li>
              {{/if}}
              <li class="active" {{action 'letGameEndInXMinutes' game game.minutesPerRound 1}}><a href="">Restart</a></li>
              <li class="active" {{action 'letGameEndInXMinutes' game 5}}><a href="">End in 5 min</a></li>
              <li class="active" {{action 'letGameEndInXMinutes' game 0.1}}><a href="">End in 1 min</a></li>
              <li class="active" {{action 'letGameEndInXMinutes' game 0}}><a href="">End Now</a></li>
              <li class="nav-divider"></li>
            {{/if}}

            <li class="active" {{action (toggle "isConfiguration" this)}}><a href="">Game Config</a></li>
            <li class="nav-divider"></li>

            {{#if isEditing}}
              <li class="active" {{action (pipe (invoke "rollbackAttributes" game) (toggle "isEditing" this)) }}><a href="">Revert Settings</a></li>
              <li class="active" {{action 'saveSettings' game}}><a href="">Save Settings</a></li>
            {{else}}
              <li class="active" {{action (toggle "isEditing" this)}}><a href="">Game Settings</a></li>
            {{/if}}

            {{#if isEditing}}
              <span>
                <div class="form-group">
                  <span class="title-container"><h5>Minutes Round: </h5></span> {{input disabled=(not isEditing) type="number" value=game.minutesPerRound class="form-control" }}
                </div>
                <div class="form-group">
                  <span class="title-container"><h5>RoundCnt: </h5></span> {{input disabled=(not isEditing) type="number" value=game.roundCnt class="form-control" }}
                </div>
                <div class="form-group">
                  <span class="title-container"><h5>WeekCnt: </h5></span> {{input disabled=1 type="number" value=game.weekCnt class="form-control" }}
                </div>
                <div class="form-group">
                  <span class="title-container"><h5>Seller Fine: </h5></span> {{input disabled=0 type="number" value=game.fine class="form-control" }}
                </div>
                <div class="form-group">
                  <span class="title-container"><h5>Seller FixedCost: </h5></span> {{input disabled=0 type="number" value=game.fixedCost class="form-control" }}
                </div>
                <div class="form-group">
                  <span class="title-container"><h5>Seller RetailPrice: </h5></span> {{input disabled=0 type="number" value=game.retailPrice class="form-control" }}
                </div>
              </span>
            {{/if}}
            
            <li class="nav-divider"></li>
            {{game.roundCnt}}

            {{#each game.gameMatrix as |item index|}}
              <li>
                {{#if (eqNum item.round game.roundCnt)}}
                  <strong>Round {{item.round}} {{item.tradeType}}</strong>
                  
                {{else}}  
                  Round {{item.round}} {{item.tradeType}}
                {{/if}}
              </li>
            {{/each}}

            {{else}}
              <h4>GAME WAS DELETED, PLEASE CHECK</h4>
            {{/unless}}

      </ul>
    </div>
  </div>
  <div class="col-xs-12 col-sm-9">

    
    {{#if isConfiguration}}

      <br>
      <div class="jumbotron">
        <a href="#" class="visible-xs" data-toggle="offcanvas"><i class="fa fa-lg fa-reorder"></i></a>
        <div class="title-container">
          <span class="line-1">Game Configuration</span>
        </div>
        <br>
        
        <div class="form-group">

          {{textarea value=game.gameConfigurationRO class="form-control game-config-textarea" col="10" rows="10"}}

          <br>

          <span class="title-container">
            <button class="btn btn-info pull-right " {{action "revertGameConfig"}}>Revert</button>
            <button class="btn btn-info pull-right " {{action "saveGameConfig"}}>Save</button>
          </span>
        </div>

        {{#if game.gameConfigurationValid}}
          
          <p>Player IDS: {{game.numberOfPlayers.allPlayerIds}} </p>
          <p>Number of Buyers: {{game.numberOfPlayers.nrOfBuyers}} </p>
          <p>Number of Sellers: {{game.numberOfPlayers.nrOfSellers}} </p>
          <p>Number of Rounds: {{game.numberOfRounds.total}} </p>

          <h3>Following rounds will be played:</h3>
          {{#each game.gameMatrix as |round|}}
            <p>{{round.roundTitle}}</p>
            <p>{{round.playerSettings}}</p>
          {{/each}}

        {{/if}}



      </div>

    {{/if}}


    {{#unless game.isDeleted}}

      <br>
  
      
      {{#timer-jumbotron game=game}}
        <span class="line-1">{{t 'masterScreen'}}</span>
      {{/timer-jumbotron}}





      <div class="row">
        <div class="col-6 col-sm-6 col-lg-6">

          {{#each game.sellers as |seller|}}
            {{player-ov isEditing=isEditing store=store player=seller game=game roleDescription=(t 'seller')}}
          {{/each}}

        </div>
        <!--/span-->
        <div class="col-6 col-sm-6 col-lg-6">

          {{#each game.buyers as |buyer|}}
              {{player-ov isEditing=isEditing store=store player=buyer game=game roleDescription=(t 'buyer')}}
          {{/each}}

          <hr>
        </div>
        <!--/span-->
      </div>
      <!--/row-->

    {{/unless}}


    {{#unless game.isDeleted}}

{{!--       <span class="title-container"><h3>Offers</h3></span>

      {{#each game.sortedOffers as |offer|}}

        <p> [{{offer.state}}] <b>{{offer.senderName}}</b> --&gt; <b>{{offer.receiver.name}}</b> {{moment-format offer.ts "HH:mm:ss"}} / {{moment-from-now offer.ts hideSuffix=true interval=1000}} T: {{offer.tomatoes}} M: {{offer.price}}</p>

      {{/each}}

      <hr> --}}


      <span class="title-container"><h4>
                      Historical Offers 
                      <button type="button" class="btn btn-primary btn-xs" {{action 'exportCSV' game.historyLogs}}>Export CSV</button></h4>
                    </span>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Round</th>
              <th>OfferId</th>
              <th>Sender</th>
              <th>Receiver</th>
              <th>Status</th>
              <th>Offer</th>
              <th>Time Stamp</th>
            </tr>
          </thead>
          <tbody>

            {{#each game.sortedHistoryLogsById as |historicalOffer|}}

              <tr class="{{historicalOffer.cssStatus}}">
                <td>{{historicalOffer.round}}</td>
                <td>{{historicalOffer.offerId}}</td>
                <td>{{historicalOffer.userSender}}</td>
                <td>{{historicalOffer.userReceiver}}</td>
                <td>{{historicalOffer.state}}</td>
                <td>{{historicalOffer.offer}}</td>
                <td>{{moment-format historicalOffer.ts "HH:mm:ss"}}</td>
              </tr>

            {{/each}}

          </tbody>
        </table>
      </div>

    {{/unless}}

  </div>
</div>
<!-- /.container -->
</div>

{{outlet}}

